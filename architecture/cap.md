# CAP란
## 실제 개념
CAP 이론이란, 분산 시스템에서 다음 3가지 속성을 동시에 만족할 수 없다는 이론입니다. 
* Consistency (일관성)
    * 모든 클라이언트가 같은 시점에 동일한 데이터를 읽을 수 있어야 합니다.
    * 특정 시점의 읽기 결과가 모든 노드에서 동일합니다.  
* Availabiliy (가용성)
    * 장애가 없는 노드에 도달한 모든 요청은 반드시 응답해야 합니다.
    * 응답은 성공이든 실패든 관계없이 제공되어야 하며, 네트워크 분할 시에도 서비스 거부 없이 동작해야 합니다. 
* Partition Tolerance (분할 내성)
    * 네트워크가 지연되거나, 일부 노드 간 연결이 끊겨도 시스템이 계속 동작해야 합니다.
 
분산 시스템에서 P는 사실상 필수입니다. 현실적으로 네트워크 장애를 0%만드는 것이 불가능하기 때문입니다. 
따라서, P를 전제로 하고, C(일관성)과 A(가용성) 중 하나를 상황에 따라 희생하는 구조를 선택해야 합니다. 
이를 통해 네트워크 분할 시에도 전체 시스템이 살아있도록 설계할 수 있습니다.
### CP
* 전략: 잘못된 값을 보여줄 바에는 일관성을 유지하고, 일부 요청은 거절하거나 대기시킵니다. (가용성 희생)
* 장점: 데이터 충돌이 없고, 강한 일관성을 보장합니다.
* 단점: 네트워크 분할 시 일부 서비스가 중단될 수 있습니다.
* 예시: 좌석 예약, 결제, 재고 관리 등 중복/오류가 치명적인 업무
* 구현: 이부 노드는 쓰기/읽기를 거부하거나 대기합니다. Zookeeper를 이용하여 과반수 노드가 응답해야 커밋하거나, 리더 가 있는 파티션만 쓰기를 허용합니다. (???)

### AP
* 전략: 서비스가 중단되지 않도록 가용성을 유지하고, 잠시 동안 서로 다른 값을 보여줄 수 있습니다. (일관성 희생)
* 장점: 서비스가 계속 지속될 수 있고, 응답이 빠릅니다. 
* 단점: 데이터가 불일치될 수 있기 때문에, 추후에 동기화와 충돌 해결이 필요합니다.
* 예시: SNS 좋아요 수, 장바구니, 피드 타임라인, 조회API 등
* 구현: 각 파티션이 독립적으로 요청을 처리하고, 나중에 데이터를 병합합니다. Cassandra, DyanamoDB 처럼 Eventually Consistent 복제를 하여 나중에 데이터가 수렴하도록 설계하고, Last Write Wins, 버전 벡터 등을 활용하여 충돌을 해결할 수 있습니다. (???)

