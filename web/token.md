# 토큰이란
## 실제 개념
토큰이란, 특정 주체의 권한이나 상태를 일시적으로 증명하는 값입니다.
비밀번호 같은 민감 정보를 직접 전달하지 않고, 대신 이 증표를 주고 받아 인증/인가를 수행할 수 있습니다.
사용하는 예시는 다음과 같습니다. 
### 주요 속성
* 랜덤성/고유성: 에측이 불가하고 충돌이 없어야 합니다.
* 만료성: 유효기간이 존재해야 하고, 짧을수록 안전합니다.
* 검증 가능성: 서명을 대조하는 등 위조와 변조를 서버가 판별할 수 있어야 합니다.
* 권한 범위: 어디까지 허용되는지(scope, ROLE 등) 명시가 가능해야 합니다.

### 종류
1. 인증/인가 토큰
    * 사용자가 로그인에 성공하면 서버가 토큰을 발급합니다.
    * 클라이언트는 요청 떄마다 헤더로 토큰을 포함하여 인증을 수행합니다.
    * 에시: JWT, OAuth Access Token, Refresh Token
1. 세션 토큰
    * 전통적인 웹 세션에서 서버가 발급하는 식별자입니다. 이에 따라 서버는 stateful 합니다.
    * JESSIONID, PHPSESSID 같은 쿠키에 실어서 인증합니다.
1. CSRF 토큰
    * 폼/상태변경 요청에서 요청 위조 방지용 1회성 난수를 발급합니다. (CSRF 공격 방지용)
    * Double-Submit Cookie, SameSite 쿠키와 함께 사용합니다.
1. API 토큰 (API Key)
    * 외부 개발자가 API를 호출할 때 사용하는 고유 키입니다.
    * 서비스에서 직접 발급받아서 헤더에 넣어 요청합니다.
1. 보안 토큰 (하드웨어)
    * OTP 기기, USB 키 같은 실물 토큰입니다.
    * 2FA으로 자주 사용됩니다.

### 전체 인증 방식
#### (1) 세션 기반 인증 (전통적 방식)
* 로그인이 성공하면, 서버가 세션 저장소에 사용자 상태를 저장합니다.
* 클라이언트는 세션 ID만 `JSESSIONID`, `PHPSESSID` 쿠키에 담깁니다.
* 이후 요청 시, 쿠키가 해당 쿠키를 자동으로 전송하면, 서버는 세션 저장소를 조회하여 사용자를 확인합니다.

#### (2) JWT 기반 토큰 인증 
* 로그인이 성공하면, 서버가 JWT를 발급합니다. (`Header.Payload.Signature`)
* 클라이언트는 JWT를 쿠키나 로컬스토리지에 저장합니다.
* 이후 요청 시, `Authorization: Bearer <jwt>` 또는 `Cookie`에 담아서 보냅니다.
* 서버는 JWT 서명만 검증하면 사용자 식별이 가능하여, 별도 세션 저장소가 불필요합니다.

### (3) 세션과 JWT를 모두 사용하는 혼합형
* 서버가 세션을 유지하지만, 세션 토큰을 JWT 형식으로 발급합니다. 즉, 세션 ID 대신 JWT를 사용합니다.
* 서버가 상태를 들고 있기 때문에 JWT의 장점이 사라지기 떄무에 실무에서는 잘 쓰이지 않지만, 권한/Scope를 담아두는 용도로는 활용하기도 합니다.

### 토큰을 쓰는 경우가 쓰지 않는 경우
* 쓰는 경우
    * 서버를 Stateless하게 운영하고 싶을 때: 서버가 세션을 저장하지 않아도 되므로, 수평확장에 유리합니다.
    * API 인증이 필요한 경우
    * OAuth / 소셜 로그인: 외부 API에 접근할 때 Access Token이 대부분 JWT입니다.
    * 마이크로서비스 간 통신: 중앙 세션없이 상호 인증이 가능합니다.
* 안쓰는 경우
    * 전통적인 서버 렌더링 웹앱: HTML 렌더링 중심이면 브라우저 쿠키 기반 세션으로 충분합니다.
    * 세션 관리가 쉬운 소규모 서비스: 서버 한대로 로드밸런싱이 필요 없는 서비스는 세션으로도 충분합니다.
    * 민감한 보안 제약이 있는 서비스: JWT는 만료 전 무효화가 어렵기 때문에 강제 로그아웃/권한차단이 필요한 경우, 세션 방식이 선호됩니다.


