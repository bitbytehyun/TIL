# 옵티마이저란
## 실제 개념
옵티마이저란, SQL 실행계획을 자동으로 결정해주는 DBMS의 핵심 엔진입니다.
예를 들어, `select.. join.. where` 같은 SQL을 작성하면, DB 내부에서는 이 쿼리를 어떤 순서와 방법으로 실행하면 가장 빨리 결과를 낼 수 있을 지 판단합니다. 
옵티마이저는 다음 기능을 담당합니다. 
1. 실행계획 생성: 테이블을 어떤 순서로 읽을지, 인덱스를 사용할 지, 어떤 인덱스를 사용할 지, 병렬처리를 할 지 등을 결정합니다. 
2. 비용 계산: 각 실행 방법에 걸리는 예상 시간과 리소스를 계산합니다. 
3. 최적의 실행경로 선택: 여러 실행 방법 중에서 비용이 가장 적은 것을 선택합니다.

단, 이는 현대 DBMS의 대부분인 비용 기반 옵티마이저에서 테이블 통계 정보(행 개수, 인덱스 분포, null 비율 등)을 활용하여 비용을 계산하고, 이는 여러개의 실행 계획을 선택하는 기준이 됩니다.
과거에는 규칙 기반 옵티마이저로, 인덱스가 있으면 인덱스를 무조건 써라 등 단순 규칙으로 실행 계획을 결정했었습니다. 

예를 들어, 다음 쿼리가 들어왔을 때, 옵티마이저는 다음과 같은 고려를 통해 비용을 계산합니다. 
```sql
SELECT *
FROM Orders o
JOIN Customer c ON o.customer_id = c.id
WHERE c.region = 'Korea'
```
* 테이블 조회 방식 선택: Full Scan, Index Range Scan, Index Full Scan 등
* Join 순서: Orders 테이블 먼저 읽을지, Customer 테이블을 먼저 읽을지
* Join 방식: Nested Loop, Hash Join, Merge Join

### 튜닝 시 유의사항
옵티마이저는 통계값을 기반으로 비용을 계산하기 때문에, 통계정보가 부정확하면 비효율적인 실행 계획을 선택할 수 있습니다.
따라서 SQL 튜닝 시에는 보통 다음 절차를 따릅니다. 
1. 통계 갱신 (`ANALYZE TABLE` 명령어) -> DB 부하 오지 않나?? 실무에서 쓰시나???
2. 인덱스 설계 개선
3. SQL 재작성

추가로, 옵티마이저 힌트를 통해 강제로 실행 계획을 유도할 수 있지만, 실무에서는 유지보수성을 해치기 때문에 가급적 사용하지 않는 편입니다. (???)
